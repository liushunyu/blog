---
layout:     post
title:      "pytorch 小技巧"
subtitle:    "pytorch 小技巧"
date:       2020-04-05 09:00:00
author:     Shunyu
header-img: img/post-bg-2015.jpg
header-mask: 0.1
catalog: true
tags:
    - python
    - pytorch
---



记录一些写 pytorch 时候不会的点。



## GPU 使用

指定 GPU

```python
import os
os.environ['CUDA_VISIBLE_DEVICES'] = '0,1'
```



查看 GPU 是否可用

```python
import torch
torch.cuda.is_available()
```



使用 cuda

```python
use_cuda = True
device = torch.device('cuda' if (torch.cuda.is_available() and use_cuda) else 'cpu')
```



## 保存提取

```python
# 保存整个网络（网络大的时候可能会比较慢）
torch.save(net, 'net.pkl')  
net = torch.load('net.pkl', map_location=device)

# 只保存网络中的参数（速度快, 占内存少）
torch.save(net.state_dict(), 'net_params.pkl')   
net.load_state_dict(torch.load('net_params.pkl'))
```



## tensorboard 使用

安装 tensorboard

```bash
pip install tensorboard
```



记录 tensorboard

```python
from torch.utils.tensorboard import SummaryWriter

# create a summary writer with automatically generated folder name.
writer = SummaryWriter()
# folder location: runs/May04_22-14-54_s-MacBook-Pro.local/

# create a summary writer using the specified folder name.
writer = SummaryWriter(log_dir="runs/experiment")
# folder location: runs/experiment/

# create a summary writer with comment appended.
writer = SummaryWriter(comment="-LR_0.1_BATCH_16")
# folder location: runs/May04_22-14-54_s-MacBook-Pro.local-LR_0.1_BATCH_16/

# scalar
writer.add_scalar(tag, scalar_value, global_step=None)
writer.add_scalars(main_tag, tag_scalar_dict, global_step=None)

# image
# img_tensor: Default is (3, H, W)
writer.add_image(tag, img_tensor, global_step=None, dataformats='CHW')
# img_tensor: Default is (N, 3, H, W)
writer.add_images(tag, img_tensor, global_step=None, dataformats='NCHW')

# graph
writer.add_graph(model, input_to_model=None)

# figure
writer.add_figure(tag, figure, global_step=None)

# close writer
writer.close()
```



查看 tensorboard

```
tensorboard --logdir=runs --host=0.0.0.0 --port=8025
```



## torchsummary

安装 torchsummary

``` bash
pip install torchsummary
```



使用 torchsummary

``` python
from torchsummary import summary
summary(model, input_size, batch_size=-1, device=torch.device('cuda:0'))
```



## tensor 转 numpy

```
a.detach().cpu().numpy()
```





## 参考资料及致谢

[莫烦PYTHON](https://morvanzhou.github.io/)

[PyTorch](https://pytorch.org/)

[pytorch-summary](https://github.com/sksq96/pytorch-summary)

